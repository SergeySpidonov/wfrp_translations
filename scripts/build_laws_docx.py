"""
build_laws_docx.py — Создаёт DOCX-файл с законами Империи
из материалов книги «Наследники Зигмара» (WFRP 2e).
"""
import sys
sys.stdout.reconfigure(encoding="utf-8")

from docx import Document
from docx.shared import Pt, RGBColor, Cm
from docx.enum.text import WD_ALIGN_PARAGRAPH

doc = Document()

# Поля страницы
for section in doc.sections:
    section.page_width   = Cm(21)
    section.page_height  = Cm(29.7)
    section.left_margin  = Cm(2.5)
    section.right_margin = Cm(2.5)
    section.top_margin   = Cm(2.5)
    section.bottom_margin = Cm(2.5)


def h(text, level=1):
    doc.add_heading(text, level=level)


def p(text, bold=False, italic=False, size=11):
    par = doc.add_paragraph()
    run = par.add_run(text)
    run.bold = bold
    run.italic = italic
    run.font.size = Pt(size)
    return par


def note(text):
    par = doc.add_paragraph()
    par.paragraph_format.left_indent = Cm(1)
    run = par.add_run(text)
    run.italic = True
    run.font.size = Pt(10)
    return par


def src(text):
    par = doc.add_paragraph()
    run = par.add_run(f"[Источник: {text}]")
    run.font.size = Pt(9)
    run.font.color.rgb = RGBColor(0x80, 0x80, 0x80)
    return par


def tbl(headers, rows):
    t = doc.add_table(rows=1 + len(rows), cols=len(headers))
    t.style = "Table Grid"
    for i, h_text in enumerate(headers):
        cell = t.rows[0].cells[i]
        cell.text = h_text
        for run in cell.paragraphs[0].runs:
            run.bold = True
    for ri, row in enumerate(rows):
        for ci, val in enumerate(row):
            t.rows[ri + 1].cells[ci].text = val
    return t


# ═══════════════════════════════════════════════════════
# ТИТУЛ
# ═══════════════════════════════════════════════════════
doc.add_heading("Законы Империи", 0)
doc.add_heading("По материалам книги «Наследники Зигмара» (Warhammer Fantasy Roleplay 2e)", 1)
p("Источник: wfrp2 Наследники Зигмара (1).pdf", italic=True, size=10)
doc.add_paragraph()

# ═══════════════════════════════════════════════════════
# 1. КТО СОЗДАЁТ ЗАКОНЫ
# ═══════════════════════════════════════════════════════
h("1. Законодательная власть: кто создаёт законы", 1)
src("Глава III: Власть и внешняя политика, стр. 26–30")

h("1.1 Император", 2)
p(
    "Теоретически Император — верховный правитель, способный издавать любые законы и применять их "
    "ко всей Империи. На практике его власть ограничена: законы должны пройти Государственный совет "
    "и Главные Усадьбы. Курфюрсты вправе игнорировать нежелательные для них имперские указы."
)

h("1.2 Государственный совет (Staatsrat)", 2)
p(
    "Постоянно действующий орган при Императоре. Формальной власти нет, но контролирует доступ к нему. "
    "Консультирует по вопросам права, финансов, дипломатии и военного дела. Попытка Императора Маттеуса II "
    "написать конституцию вокруг Совета была тихо пресечена курфюрстами."
)
doc.add_paragraph()

tbl(
    headers=["Имя", "Обязанности"],
    rows=[
        ["Великий Теогонист Эсмер III", "Духовные вопросы"],
        ["Граф Зигфрид фон Вальфен", "Канцлер Рейкланда (имперская разведка)"],
        ["Верховный Патриарх Бальтазар Гельт", "Советник по магическим вопросам"],
        ["Амадей Менкен, барон Штиргау", "Камердинер печати (международные отношения)"],
        ["Рейксмаршал Курт Хелльборг", "Личный военный советник Императора"],
        ["Лотта Хохсволл, баронесса Штимсвальдская", "Канцлер Имперского фиска"],
        ["Лектор Агата фон Берн (Культ Верены)", "Верховный законник (юридические вопросы)"],
        ["Арне Дамштадт, герцог Гейльборнский", "Камергер Императорского дома"],
    ]
)
doc.add_paragraph()

h("1.3 Верховный законник — Агата фон Берн", 2)
p(
    "Лектор Культа Верены, отвечает за юридические вопросы в Государственном совете. По слухам, "
    "«блеск золота способен вызвать у неё божественное вдохновение, особенно если дело выглядит скверно»."
)

h("1.4 Курфюрсты", 2)
p(
    "Каждый из 10 правителей Великих провинций может издавать законы на своей территории. "
    "В автократических провинциях (Талабекланд, Нордланд) вся власть у курфюрста. "
    "В Рейкланде существует парламент (дворяне, духовенство, мещане), консультирующий и служащий "
    "апелляционным судом; последнее слово остаётся за курфюрстом."
)
doc.add_paragraph()

tbl(
    headers=["Провинция", "Курфюрст (2522 г. И.К.)"],
    rows=[
        ["Аверланд", "Спорно (Лейтдорф убит в 2250 г.)"],
        ["Хохланд", "Альдебранд Люденхоф"],
        ["Мидденланд", "Борис Тодбрингер"],
        ["Мут", "Хисме Штаутхарт"],
        ["Нордланд", "Теодерик Гауссер"],
        ["Остермарк", "Вольфрам Гертвиг"],
        ["Остланд", "Вальмир фон Рауков"],
        ["Рейкланд", "Карл-Франц I (Император)"],
        ["Штирланд", "Альберих Гаупт-Андерссен"],
        ["Талабекланд", "Хальмут Фейербах (считается погибшим)"],
        ["Виссенланд", "Эммануэль фон Либвиц"],
    ]
)
doc.add_paragraph()

h("1.5 Городские хартии (Stadtrechte)", 2)
p(
    "Вольные города получают права и привилегии в обмен на услуги. Пример: Кемпербад в 1066 г. получил "
    "хартию от Императора Бориса, сняв обязательства перед Рейкландом за редкие вина. "
    "Штрайссен — хартию с правом самоуправления, впоследствии отнятую курфюрстиной при подавлении "
    "хлебного бунта (2502 г.)."
)

h("1.6 Сфера имперского и провинциального права", 2)
p(
    "Имперское право охватывает: доходы, безопасность от внешних и внутренних угроз, регулирование "
    "колдовства, искоренение культов Хаоса. "
    "Провинциальное право — гражданские и уголовные дела: преступления против собственности и "
    "личности, гражданские иски. "
    "В Талабхейме сохраняются книги прецедентов со времён Основания: «знание есть закон»."
)

# ═══════════════════════════════════════════════════════
# 2. ВИДЫ ПРЕСТУПЛЕНИЙ
# ═══════════════════════════════════════════════════════
h("2. Виды преступлений", 1)
src("Глава IV, стр. 31–38")

tbl(
    headers=["Тип", "Примеры", "Стр."],
    rows=[
        ["Кражи и мошенничество",
         "'Рыбаки' (крючки в окна), 'фальшивые флаги' (разведчики-слуги), подделка "
         "имперской ливреи ('капитан Франц', Гриссенвальд)",
         "31–32"],
        ["Грабёж и вымогательство",
         "Разбойники на дорогах; 'защита от пожара' в торговых лавках за деньги",
         "31–32"],
        ["Скупка краденого",
         "Закон не делает различий между вором и скупщиком",
         "32"],
        ["Речное пиратство",
         "Угонщики и пираты на водных путях; банда на Рейке между Карробургом и Пустошью",
         "32"],
        ["Убийство", "Смертное преступление по всей Империи", "38, 32"],
        ["Поклонение запрещённым культам",
         "Кхорн, Тзинч, Нургл, Слаанеш, Каин, Штромфельс, Талос",
         "38–41"],
        ["Незаконное колдовство",
         "Чародейство без лицензии Коллегии магии подозревается народом и Охотниками на ведьм",
         "29, 34"],
        ["Незаконная добыча на дварфских землях",
         "Горняки, вторгшиеся на территорию дварфов — суд + компенсация",
         "50"],
        ["Неявка в суд присяжных",
         "Само по себе тяжкое преступление; бейлиф вправе принудить к участию в жюри",
         "34"],
    ]
)
doc.add_paragraph()

# ═══════════════════════════════════════════════════════
# 3. ПРАВООХРАНИТЕЛЬНЫЕ ОРГАНЫ
# ═══════════════════════════════════════════════════════
h("3. Правоохранительные органы", 1)
src("Глава IV, стр. 35–36")

h("3.1 Патрульные", 2)
p(
    "Стражи сельской местности, патрулируют дороги, проверяют трактиры и фермы. Служат "
    "городской, дворянской или курфюрстской власти. Вправе вершить правосудие на месте — "
    "неофициальные суды в трактирах, деревенских залах или прямо на дороге. "
    "В кризисное время нередко вешают без должного судопроизводства."
)

h("3.2 Городская стража (дозорные)", 2)
p(
    "Несут службу в городах. Мелкие нарушения разбираются сержантами в 'мелких судах' "
    "прямо на посту стражи. При незначительных делах вправе выписать штраф на месте."
)

h("3.3 Охотники на ведьм", 2)
p(
    "Созданы Великим Теогонистом Зибольдом II; при Магнусе Благочестивом переданы под власть "
    "Императора, действуют «на благо всей Империи и во имя всех культов». Имеют универсальную "
    "юрисдикцию, превосходящую местные власти. При себе — грамота с печатью. "
    "Штаб-квартира в Альтдорфе с тюрьмой. "
    "Пример: в 2011 г. разоблачили курфюрста Конрада фон Блутхейма из Виссенланда "
    "как служителя Кхорна."
)

h("3.4 Странствующие судьи", 2)
p(
    "Адвокаты без городской практики, получившие лицензию. Наделены полномочиями на определённом "
    "участке земли: могут приговаривать к повешению, заключать в колодки, разрешать земельные "
    "споры, совершать браки. Традиционно ведут суды сидя на огромной книге. "
    "Носят богато украшенные шляпы как знак профессии. Зарплата зависит от числа дел."
)

h("3.5 Охотники за головами", 2)
p("Действуют в частном порядке, когда государственные органы не вмешиваются.")

# ═══════════════════════════════════════════════════════
# 4. СУДЕБНАЯ СИСТЕМА
# ═══════════════════════════════════════════════════════
h("4. Судебная система", 1)
src("Глава IV, стр. 34–37")

h("4.1 Имперские суды", 2)
p(
    "Во всех крупных городах и столицах провинций; судьи назначаются Императором через "
    "канцелярию Имперского Генерального Прокурора. Часто конфликтуют с местными властями "
    "из-за тысячелетних противоречий в законах."
)

h("4.2 Провинциальные суды", 2)
p(
    "Гражданские и уголовные дела рассматриваются вместе. На севере и востоке — перед дворянином "
    "или бейлифом; на юге и западе — суд присяжных (любой взрослый под рукой). "
    "В сельской местности — феодальный суд поместного лорда. Апелляции разрешены, "
    "но рассматриваются месяцами."
)

h("4.3 Мелкие суды", 2)
p(
    "Пьянство, публичные драки — сержанты стражи на посту. "
    "Наказание: штраф 1 шил. – 1 кр. или до 5 ударов плетью."
)

h("4.4 Суды гильдий", 2)
p(
    "Гильдейский совет мастеров разбирает обвинения против членов гильдии. "
    "Наказания: штраф, возмещение ущерба, лишение учеников, исключение из гильдии "
    "(= лишение права ремесла). «Чёрная метка» — запечатанная чёрным сургучом записка "
    "или физическая расправа на задворках."
)

h("4.5 Храмовые суды", 2)
p(
    "Тайные суды для деликатных дел: например, отступничество жреца. Под эгидой верховного "
    "жреца. Презумпция вины ещё жёстче. Наказания скрыты от публики: заточение в катакомбах "
    "или монастыре, удушение + обезглавливание + погребение."
)

h("4.6 Ключевые принципы имперского судопроизводства", 2)
tbl(
    headers=["Принцип", "Описание"],
    rows=[
        ["Презумпция вины", "Обвиняемый обязан доказать невиновность"],
        ["Состязательность", "Адвокаты обеих сторон излагают аргументы и допрашивают свидетелей"],
        ["Перекрёстный допрос", "Каждая сторона допрашивает свидетелей противника"],
        ["Активный судья", "Сам допрашивает, может оштрафовать некомпетентного адвоката"],
        ["Апелляция", "Разрешена везде; тюрьма — немедленно, смерть — после апелляций"],
        ["Коллегия трёх", "При серьёзных делах — три судьи; на западе/юге — также присяжные"],
    ]
)
doc.add_paragraph()

# ═══════════════════════════════════════════════════════
# 5. МЕХАНИКА СУДА
# ═══════════════════════════════════════════════════════
h("5. Процедура суда (игровые правила)", 1)
src("Глава IV, стр. 36–37")

p(
    "Суд — серия из трёх встречных проверок навыков. "
    "Побеждает адвокат, выигравший в двух из трёх фаз."
)
doc.add_paragraph()

tbl(
    headers=["Фаза", "Описание", "Навык"],
    rows=[
        ["1 — Предварительные аргументы",
         "Изложение версий, опираясь на знание законов. Без «Академических знаний (Закон)» — замена "
         "на «Общие знания» со штрафом –20%.",
         "Академические знания (Закон)"],
        ["2 — Свидетели",
         "Представление и перекрёстный допрос; цель — выявить противоречия и ложь.",
         "Восприятие"],
        ["3 — Заключительные аргументы",
         "Убеждение судьи в единственно верном решении.",
         "Очарование"],
    ]
)
doc.add_paragraph()

p("Таблица 4-1: Сложность судебного разбирательства", bold=True)
tbl(
    headers=["Сложность", "Модификатор", "Фаза", "Пример"],
    rows=[
        ["Очень легко", "+30%", "2", "Враждебные свидетели — преступники, иностранцы, отбросы"],
        ["Легко", "+20%", "3", "Подзащитный более высокого соц. класса, чем обвинитель"],
        ["Просто", "+10%", "1", "Подзащитный — член гильдии или церкви, ведущей дело"],
        ["Средне", "+0%", "Все", "Особых обстоятельств нет"],
        ["Сложно", "–10%", "3", "Подзащитный ранее судим"],
        ["Трудно", "–20%", "3", "Подзащитный обвиняется в связях с Хаосом"],
        ["Очень трудно", "–30%", "2", "Преступление видели несколько доверенных свидетелей"],
    ]
)
doc.add_paragraph()

note(
    "Нечестные методы (шантаж, подкуп, классовые привилегии) допустимы — детали на усмотрение ведущего."
)

# ═══════════════════════════════════════════════════════
# 6. НАКАЗАНИЯ
# ═══════════════════════════════════════════════════════
h("6. Наказания", 1)
src("Глава IV, стр. 35–37; дневник палача (стр. 32)")

tbl(
    headers=["Степень", "Наказание", "Орган"],
    rows=[
        ["Мелкое нарушение", "Штраф (1 шил. – 1 кр.) или до 5 ударов плетью", "Мелкий суд стражи"],
        ["Незначительное", "Штраф на месте", "Стражники по усмотрению"],
        ["Среднее", "Удары плетью (20+), штраф", "Обычный суд / судья"],
        ["Тяжкое", "Тюрьма, колодки, изгнание, каторга", "Обычный / имперский суд"],
        ["Тяжкое (телесное)", "Клеймение, увечье", "Суд (исполнение — после апелляции)"],
        ["Тяжкое (смертное)", "Повешение, обезглавливание, утопление, сожжение", "Суд (после апелляций)"],
        ["Убийство + Хаос", "Пытки и обезглавливание", "Странствующий судья / суд"],
        ["Отступничество жреца", "Удушение + обезглавливание + погребение", "Тайный храмовый суд"],
    ]
)
doc.add_paragraph()

note(
    "Из дневника странствующего палача, 17 Зигмарзейта 2521 г., Дельберц:\n"
    "Мужчина 30 лет — 20 ударов плетью за кражу двух свиней. "
    "Женщина 50 лет — 5 ударов плетью + штраф за публичное пьянство и богохульство. "
    "Двое мужчин 18 и 27 лет — пытки и обезглавливание за убийство и поклонение Хаосу. "
    "«Лезвие было острым, хватило по одному взмаху каждому.»"
)
doc.add_paragraph()

# ═══════════════════════════════════════════════════════
# 7. ЗАПРЕЩЁННЫЕ КУЛЬТЫ
# ═══════════════════════════════════════════════════════
h("7. Запрещённые культы и наказания", 1)
src("Глава V, стр. 38–41")

tbl(
    headers=["Бог / Культ", "Описание", "Наказание"],
    rows=[
        ["Кхорн", "Бог крови и убийств", "Смерть (обезглавливание или сожжение)"],
        ["Тзинч", "Великий Заговорщик, бог перемен", "Смерть"],
        ["Нургл", "Повелитель Мух, бог болезней", "Смерть (утопление)"],
        ["Слаанеш", "Принц Похоти, бог извращений", "Смерть (сожжение)"],
        ["Каин", "Бог убийц и отравителей; возможно, аспект Кхорна", "Смерть"],
        ["Талос", "'Вечный враг дварфов', бог вост. Штирланда", "Смерть"],
        ["Штромфельс", "Акулий Бог; запрещённый подкульт Мананна, бог опасностей моря", "Смерть"],
    ]
)
doc.add_paragraph()

p(
    "Для менее опасных запрещённых культов первое нарушение может карается штрафом или "
    "ударами плетью. Четыре повелителя Хаоса, Каин, Талос и Штромфельс — всегда смертная казнь."
)

# ═══════════════════════════════════════════════════════
# 8. РОЛЬ КУЛЬТА ВЕРЕНЫ
# ═══════════════════════════════════════════════════════
h("8. Роль Культа Верены в правосудии", 1)
src("Глава V, стр. 40")

p(
    "Верена — богиня мудрости и справедливости. Её жрецы составляют значительную фракцию "
    "судебной власти, уступая лишь зигмаритам. Когда они не вовлечены в процесс, нередко "
    "вмешиваются в роли «друга суда», если опасаются, что правосудие не свершится. "
    "Верховный законник Государственного совета — Агата фон Берн (см. раздел 1.3). "
    "После разрушений войны культ занимается спасением важных артефактов и документов."
)

h("Подкульты Верены", 2)
tbl(
    headers=["Подкульт", "Покровительство"],
    rows=[
        ["Клио", "Историки и исследователи (аспект 'Погружение в прошлое')"],
        ["Ренбет", "Мужской аспект, бог Совершенного Адвоката; следует за истиной, куда бы ни привели улики"],
        ["Скрипсисти", "Каллиграфы; борются против распространения печатных станков"],
    ]
)
doc.add_paragraph()

# ═══════════════════════════════════════════════════════
# 9. СТРАННЫЕ ЗАКОНЫ
# ═══════════════════════════════════════════════════════
h("9. Странные законы Империи", 1)
src("Врезка, Глава IV, стр. 33")

p("За 2500+ лет накопились сотни устаревших и противоречивых законов. Примеры:")
doc.add_paragraph()

tbl(
    headers=["Закон", "Место / Год", "Примечание"],
    rows=[
        ["Полурослик без хозяина не может свободно входить в Ларсвальд",
         "Аверхейм, 2111 г.", "Принят после серии краж"],
        ["Задняя часть лошадей при движении по улицам должна быть покрыта тканью",
         "Мидденхейм, XXIV в.", "Граф слишком часто ставил ногу не туда; кучера взбунтовались"],
        ["Причалы Императрицы Аннет: 2 шил./фут/день; все суда обязаны там швартоваться",
         "Альтдорф, 2398 г.", "Интерес делового партнера чиновника; район ныне заброшен"],
        ["Оружие длиннее короткого меча при входе в город — доказательство заговора",
         "Пфейльдорф, 1977 г.", "После беспорядков болельщиков; редко исполняется"],
        ["Первые 3 часа после заката — только гимны Зигмару. Штраф 1 кр./певец",
         "Нульн, 2200-е гг.", "Использовался для закрытия шумных заведений"],
        ["Реке Штир запрещено подниматься выше моста Гроссвег",
         "Вюртбад, после 1512 г.", "Случаев исполнения не зафиксировано"],
        ["Дварф имеет приоритет на дорогах в месяц Зигмарзейт",
         "Аверланд, IX в.", "Цитируется пьяными дварфами"],
    ]
)
doc.add_paragraph()

# ═══════════════════════════════════════════════════════
# 10. ПРОВИНЦИАЛЬНЫЕ ОСОБЕННОСТИ
# ═══════════════════════════════════════════════════════
h("10. Правовые особенности провинций", 1)
src("Глава VI, стр. 50–138")

h("Аверланд", 2)
p(
    "Нетерпимость к адвокатам и договорам — любой контракт подразумевает, что человек может "
    "передумать. Сделки делаются «по чести». Горнодобытчики, вторгшиеся на дварфские земли — "
    "суд + компенсация; курфюрсты тайно велели поддерживать интересы дварфов."
)

h("Мутланд", 2)
p(
    "Наказание за убийство у полурослей — не повешение, а изгнание «пока не поймёт, что "
    "сделал, и не захочет вернуться». Приговор подтверждается на собрании."
)

h("Рейкланд", 2)
p(
    "Парламент в замке Рейкгард: дворяне, духовенство, мещане. Консультирует курфюрста, "
    "служит апелляционным судом."
)

h("Талабхейм", 2)
p("Книги прецедентов со времён Основания. «Знание есть закон».")

h("Север и восток", 2)
p("Слушания перед дворянином или бейлифом; суда присяжных нет.")

h("Запад и юг", 2)
p("Традиция суда присяжных: любой взрослый. Неявка — тяжкое преступление.")

# ═══════════════════════════════════════════════════════
# 11. СВОДНАЯ ТАБЛИЦА
# ═══════════════════════════════════════════════════════
h("11. Сводная таблица: Преступление — Наказание — Источник", 1)

tbl(
    headers=["Преступление", "Наказание", "Стр."],
    rows=[
        ["Кража свиней у соседа", "20 ударов плетью", "32 (дневник)"],
        ["Публичное пьянство + богохульство", "5 ударов плетью + штраф", "32 (дневник)"],
        ["Убийство + Хаос", "Пытки + обезглавливание", "32 (дневник)"],
        ["Мелкое нарушение", "Штраф 1 шил.–1 кр. или до 5 ударов", "35"],
        ["Поклонение Кхорну", "Смерть", "38"],
        ["Поклонение Нурглу", "Смерть (утопление)", "38"],
        ["Поклонение Слаанешу", "Смерть (сожжение)", "38"],
        ["Поклонение Тзинчу", "Смерть", "38"],
        ["Поклонение Каину", "Смерть", "41"],
        ["Поклонение Штромфельсу", "Смерть", "41"],
        ["Убийство (общая норма)", "Смерть через повешение", "38"],
        ["Убийство (полурослики)", "Изгнание", "~68"],
        ["Продажа краденого", "Как за кражу", "32"],
        ["Исключение из гильдии", "Лишение права ремесла", "35"],
        ["Отступничество жреца", "Удушение + обезглавливание", "35"],
        ["Незаконная добыча на землях дварфов", "Суд + компенсация", "50"],
        ["Неявка в суд присяжных", "Тяжкое преступление", "34"],
        ["Пение не гимнов в тавернах (Нульн)", "1 кр./певец или закрытие", "33"],
        ["Полурослик в Ларсвальде без хозяина", "Нарушение закона 2111 г.", "33"],
    ]
)
doc.add_paragraph()
p("— конец документа —", italic=True, size=9)

output = "Законы Империи (Наследники Зигмара).docx"
doc.save(output)
print(f"Сохранено: {output}")
